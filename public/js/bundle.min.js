!function(){var e={base_url:"http://localhost:3000",hideModals:function(){document.querySelectorAll(".modal").forEach(e=>{e.classList.remove("is-active")})}};const t={makeTagInDOM:function(e){const a=document.createElement("span");a.classList.add("tag"),a.textContent=e.name,a.dataset.tagId=e.id,a.addEventListener("dblclick",t.dissociateTagFromCard),document.querySelector(`.box[data-card-id="${e.card_has_tag.card_id}"`).appendChild(a)},dissociateTagFromCard:async function(t){const a=t.target.dataset.tagId,o=t.target.closest(".box").dataset.cardId;try{await fetch(`${e.base_url}/cards/${o}/tag/${a}`,{method:"DELETE"}),t.target.remove()}catch(s){console.error(s),alert("Impossible de dissocier le tag de la carte !")}},showAssociateTagModal:function(e){document.getElementById("associateTagModal").classList.add("is-active");const t=e.target.closest(".box").dataset.cardId;document.querySelector('#associateTagModal input[name="card_id"]').value=t},fillSelectAssociateTagModal:async function(){const t=document.querySelector("#associateTagModal select"),a=await fetch(e.base_url+"/tags"),o=await a.json();for(const e of o){const a=document.createElement("option");a.textContent=e.name,a.value=e.id,t.appendChild(a)}},handleAssociateTagForm:async function(a){a.preventDefault();const o=new FormData(a.target),s=o.get("card_id");try{const a=await fetch(`${e.base_url}/cards/${s}/tag`,{method:"POST",body:o}),d=(await a.json()).tags.find(e=>e.id==o.get("tag_id"));t.makeTagInDOM(d)}catch(d){console.error(d),alert("Impossible d'associer le tag \xe0 la carte !")}e.hideModals()}};var a=t;const o={showAddCardModal:function(e){const t=document.querySelector('#addCardModal input[name="list_id"]'),a=e.target.closest(".panel");t.value=a.dataset.listId,document.getElementById("addCardModal").classList.add("is-active")},handleAddCardForm:async function(t){t.preventDefault();const a=new FormData(t.target);try{const t=await fetch(e.base_url+"/cards",{method:"POST",body:a}),s=await t.json();o.makeCardInDOM(s)}catch(s){console.error(s),alert("Impossible d'ajouter la carte !")}e.hideModals()},makeCardInDOM:function(e){const t=document.getElementById("templateCard").content.cloneNode(!0),s=t.querySelector(".box");s.style.backgroundColor=e.color,t.querySelector(".title-card").textContent=e.title;const d=document.querySelector(`.panel[data-list-id="${e.list_id}"]`);s.dataset.cardId=e.id,t.querySelector(".icon-add-tag").addEventListener("click",a.showAssociateTagModal),t.querySelector(".icon-edit-card").addEventListener("click",o.showEditCardForm),t.querySelector(".form-edit-card").addEventListener("submit",o.handleEditCardForm),t.querySelector('input[name="list_id"]').value=e.list_id,t.querySelector(".icon-delete-card").addEventListener("click",o.deleteCard),d.querySelector(".panel-block").appendChild(t)},showEditCardForm:function(e){const t=e.target.closest(".box");t.querySelector(".title-card").classList.add("is-hidden"),t.querySelector(".form-edit-card").classList.remove("is-hidden")},handleEditCardForm:async function(t){t.preventDefault();const a=new FormData(t.target),o=t.target.closest(".box"),s=o.dataset.cardId,d=o.querySelector(".title-card");try{await fetch(`${e.base_url}/cards/${s}`,{method:"PATCH",body:a}),d.textContent=a.get("title"),o.style.backgroundColor=a.get("color")}catch(r){console.error(r),alert("Impossible de modifier la carte !")}t.target.classList.add("is-hidden"),d.classList.remove("is-hidden")},deleteCard:async function(t){const a=t.target.closest(".box"),o=a.dataset.cardId;try{await fetch(`${e.base_url}/cards/${o}`,{method:"DELETE"}),a.remove()}catch(s){console.error(s),alert("Impossible de supprimer la carte !")}},updatePositionCards:function(t,a){t.forEach(async(t,o)=>{const s=t.dataset.cardId;try{await fetch(`${e.base_url}/cards/${s}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({position:o,list_id:a})})}catch(d){console.error(d),alert("Impossible de d\xe9placer la carte !")}})}};var s=o;const d={showAddListModal:function(){document.getElementById("addListModal").classList.add("is-active")},handleAddListForm:async function(t){t.preventDefault();const a=new FormData(t.target);try{const t=await fetch(e.base_url+"/lists",{method:"POST",body:a});t.ok||alert("Il y a eu un probl\xe8me lors de l'envoi de la liste au serveur !");const o=await t.json();console.log(o),d.makeListInDOM(o)}catch(o){console.error(o),alert("Impossible de cr\xe9er la liste !")}e.hideModals()},makeListInDOM:function(e){const t=document.getElementById("templateList").content.cloneNode(!0),a=t.querySelector(".panel h2");a.textContent=e.name,a.addEventListener("dblclick",d.showEditListForm),t.querySelector(".panel").dataset.listId=e.id,t.querySelector(".btn-add-card").addEventListener("click",s.showAddCardModal),t.querySelector(".form-edit-list").addEventListener("submit",d.handleEditListForm),t.querySelector(".icon-delete-list").addEventListener("click",d.deleteList);const o=t.querySelector(".panel-block");new Sortable(o,{group:"list",draggable:".box",onEnd:function(e){let t=e.from.querySelectorAll(".box"),a=e.from.closest(".panel").dataset.listId;s.updatePositionCards(t,a),e.from!==e.to&&(t=e.to.querySelectorAll(".box"),a=e.to.closest(".panel").dataset.listId,s.updatePositionCards(t,a))}}),document.querySelector(".card-lists").appendChild(t)},showEditListForm:function(e){e.target.classList.add("is-hidden"),e.target.closest(".panel").querySelector(".form-edit-list").classList.remove("is-hidden")},handleEditListForm:async function(t){t.preventDefault();const a=new FormData(t.target),o=t.target.closest(".panel").querySelector("h2"),s=t.target.closest(".panel").dataset.listId;try{await fetch(`${e.base_url}/lists/${s}`,{method:"PATCH",body:a}),o.textContent=a.get("name")}catch(d){console.error(d),alert("Impossible de mettre \xe0 jour la liste !")}t.target.classList.add("is-hidden"),o.classList.remove("is-hidden")},deleteList:async function(t){if(!confirm("Etes vous s\xfbr de vouloir supprimer cette liste ?"))return;const a=t.target.closest(".panel"),o=a.dataset.listId;try{await fetch(`${e.base_url}/lists/${o}`,{method:"DELETE"}),a.remove()}catch(s){console.error(s),alert("Impossible de supprimer la liste !")}}};var r=d;const n={init:function(){n.getListsFromAPI(),n.addListenerToActions(),a.fillSelectAssociateTagModal()},addListenerToActions:function(){document.getElementById("addListButton").addEventListener("click",r.showAddListModal);const t=document.getElementsByClassName("close");for(const a of t)a.addEventListener("click",e.hideModals);document.querySelector("#addListModal form").addEventListener("submit",r.handleAddListForm),document.querySelector("#addCardModal form").addEventListener("submit",s.handleAddCardForm),document.querySelector("#associateTagModal form").addEventListener("submit",a.handleAssociateTagForm)},getListsFromAPI:async function(){try{const t=await fetch(e.base_url+"/lists"),o=await t.json();for(const e of o){r.makeListInDOM(e);for(const t of e.cards){s.makeCardInDOM(t);for(const e of t.tags)a.makeTagInDOM(e)}}const d=document.querySelector(".card-lists");new Sortable(d,{draggable:".panel",onEnd:function(){document.querySelectorAll(".panel").forEach(async(t,a)=>{const o=t.dataset.listId;await fetch(`${e.base_url}/lists/${o}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({position:a})})})}})}catch(t){console.error(t)}}};document.addEventListener("DOMContentLoaded",n.init)}();